<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body style="background:#111;color:#fff;padding:20px;font-family:Arial">

<h2>Admin Dashboard</h2>

<input id="name" placeholder="Agent Name"><br><br>
<input id="desc" placeholder="Description"><br><br>
<input id="image" placeholder="Image URL"><br><br>
<input id="whatsapp" placeholder="WhatsApp Number"><br><br>
<input id="phone" placeholder="Phone Number"><br><br>

<button onclick="addAgent()">Add / Update Agent</button>
<button onclick="logout()">Logout</button>

<hr>
<div id="list"></div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAJZ7e134Fnt3Cxe1aiDkFUg_Wv0ehpBA0",
  authDomain: "piyush-agency-b7949.firebaseapp.com",
  databaseURL: "https://piyush-agency-b7949-default-rtdb.firebaseio.com",
  projectId: "piyush-agency-b7949"
};

firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const auth = firebase.auth();

let editId = null;

auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "login.html";
  }
});

function logout() {
  auth.signOut().then(() => {
    window.location.href = "login.html";
  });
}

function addAgent() {
  const data = {
    name: name.value,
    desc: desc.value,
    image: image.value,
    whatsapp: whatsapp.value,
    phone: phone.value
  };

  if (editId) {
    db.ref("agents/" + editId).update(data);
    editId = null;
  } else {
    db.ref("agents").push(data);
  }

  alert("Saved");
}

db.ref("agents").on("value", snap => {
  list.innerHTML = "";
  snap.forEach(child => {
    const a = child.val();
    list.innerHTML += `
      <div style="border:1px solid red;padding:10px;margin-bottom:10px">
        <b>${a.name}</b><br>
        ${a.desc}<br><br>
        <button onclick="editAgent('${child.key}','${a.name}','${a.desc}','${a.image}','${a.whatsapp}','${a.phone}')">Edit</button>
        <button onclick="delAgent('${child.key}')">Delete</button>
      </div>
    `;
  });
});

function editAgent(id,n,d,i,w,p){
  editId = id;
  name.value = n;
  desc.value = d;
  image.value = i;
  whatsapp.value = w;
  phone.value = p;
}

function delAgent(id){
  if(confirm("Delete this agent?")){
    db.ref("agents/" + id).remove();
  }
}
</script>

</body>
</html>
