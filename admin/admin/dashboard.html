<!DOCTYPE html>
<html>
<head>
<title>Admin Dashboard</title>
<meta name="viewport" content="width=device-width">
</head>

<body style="background:#111;color:#fff;padding:20px">

<h2>Admin Dashboard</h2>

<input id="name" placeholder="Agent Name"><br><br>
<input id="desc" placeholder="Description"><br><br>
<input id="image" placeholder="Image URL"><br><br>
<input id="whatsapp" placeholder="WhatsApp Number"><br><br>
<input id="phone" placeholder="Phone Number"><br><br>

<button onclick="addAgent()">Add / Update Agent</button>
<button onclick="logout()">Logout</button>

<hr>
<div id="list"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAJZ7e134Fnt3Cxe1aiDkFUg_Wv0ehpBA0",
  authDomain: "piyush-agency-b7949.firebaseapp.com",
  databaseURL: "https://piyush-agency-b7949-default-rtdb.firebaseio.com",
  projectId: "piyush-agency-b7949"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

let editId=null;

onAuthStateChanged(auth,u=>{
 if(!u) location.href="login.html";
});

window.logout=()=>signOut(auth);

window.addAgent=()=>{
 if(editId){
  update(ref(db,"agents/"+editId),{
   name:name.value,desc:desc.value,image:image.value,
   whatsapp:whatsapp.value,phone:phone.value
  });
  editId=null;
 }else{
  push(ref(db,"agents"),{
   name:name.value,desc:desc.value,image:image.value,
   whatsapp:whatsapp.value,phone:phone.value
  });
 }
 alert("Saved");
};

onValue(ref(db,"agents"), snap=>{
 list.innerHTML="";
 snap.forEach(c=>{
  const a=c.val();
  list.innerHTML+=`
   <div style="border:1px solid red;padding:10px;margin-bottom:10px">
    <b>${a.name}</b><br>${a.desc}<br>
    <button onclick="editAgent('${c.key}','${a.name}','${a.desc}','${a.image}','${a.whatsapp}','${a.phone}')">Edit</button>
    <button onclick="del('${c.key}')">Delete</button>
   </div>`;
 });
});

window.editAgent=(id,n,d,i,w,p)=>{
 editId=id;
 name.value=n;desc.value=d;image.value=i;whatsapp.value=w;phone.value=p;
};

window.del=id=>{
 if(confirm("Delete?")) remove(ref(db,"agents/"+id));
};
</script>

</body>
</html>
